import {GLTFLoader} from 'three/examples/jsm/loaders/GLTFLoader'
import * as main from '../script'

//      Initializing loader module properties
//
//Object to store loaded models
//Add empty keys for each model loaded to calculate loading percentage
let models = {
    playerCharacter:null
}

//player animations are stored here
let playerAnimations = null

//assign the number assets imported in this module
const numberOfAssets = Object.keys(models).length

//value representing how much has loaded,
//ranging from 0 to 1. 
//Adds a percentage when an asset is loaded.
//Value should be 100 when all assets are loaded.
let loadedPercentage = 0 
//
//      end of Initializing loader module properties

//      Creating a progress bar
//
let progressBar = require('progressbar.js')
let loadingBar = new progressBar.Circle('#progress-bar-container' /* Element that will contain SVG generated by progressbar.js */,{ 
    //add necessary styling/properties. Refer https://progressbarjs.readthedocs.io/en/latest/api/shape/ 
})

//set the progress bar value to 0
loadingBar.animate(loadedPercentage)
//
//      end of Creating a progress bar


//      Loading models
//
const gltfloader = new GLTFLoader()

//Boilerplate for importing a model. Change variable names and path to the asset
//Once a model is loaded, add it to the models object
/* 
gltfloader.load(
    'Model path',
    (gltf2) =>
    {
        models['modelKey'] = gltf2.scene; // adding the model to the models object
        //set initial properties here

        loadedPercentage += (1/numberOfAssets) //calculate the percentage the asset contributes to the total loadedPercentage
        loadingBar.animate(loadedPercentage) // animate the progress bar
        if(loadedPercentage >= 1){ //if loadedPercentage is 1, then the survey can start.
            //Call function to start the survey
        }
    }
)  
*/


//Importing player character
gltfloader.load(
    'Models/AnimationTest_V11-test.gltf',
    (gltf) =>
    {
        playerAnimations = gltf.animations
        let model = gltf.scene
        model.scale.set(.07,.07,.07)
        model.position.set(0,-.6, 2)

        models['playerCharacter'] = model; // adding the model to the models object
        
        loadedPercentage += (1/numberOfAssets) //calculate the percentage the asset contributes to the total loadedPercentage
        loadingBar.animate(loadedPercentage) // animate the progress bar
        if(loadedPercentage >= 1){ //if loadedPercentage is 1, then the survey can start.
            //Call function to start the survey
            main.startSurvey()
        }
    }
)  


//
//      end of Loading models


export function getModel(modelKey){
    return models[modelKey]
}

export function getPlayerAnimations(){
    return playerAnimations
}